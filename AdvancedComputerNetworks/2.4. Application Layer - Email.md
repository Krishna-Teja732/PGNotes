
### 1. Simple Mail transfer protocol SMTP
- **Purpose**
	- Used to send mails 
- **Characteristics**
	- Stateless text based protocol
	- Only text based emails(Cannot send multimedia data)
	- Uses TCP as transport protocol
	- Push based protocol
		- Can be used to send emails, but not for receiving them
- **Components**
	- User agent:
		- Used by the end user for composing, reading and saving emails
		- Each user agent is associated with a mail server
		- Examples: Outlook, Thunderbird
	- Mail server:
		- Stores and forwards the emails of users 
		- Each user has a mail box. All mails sent to the user is stored in the mail box
- **What happens when Alice sends email to Bob?**  
	- Alice composes and sends an email using her user agent 
		- Alice mentions the recipient email id in the email  
	- Alice's user agent sends the email to her mail server(sender mail server)
	- Sender mail server stores the mail in a message queue
		- To forward the email, the sender's email server establishes a TCP connection with the receiver's mail server 
		- Once TCP connection is established, SMTP handshake is done
		- After the SMTP handshake, the sender mail server sends the email over the TCP connection
		- The recipient mail server receives the email and stores it in Bob's mail box
	- When Bob wants to retrieve his emails, his user agent authenticates with his respective mail server
	- Once Bob is authenticated, his user agent retrieves his emails
- **What happens if sender's mail server cannot send the email?**
	- Lets say Bob's email server did not accept the TCP connection
	- Alice's Mail server retries, then sends a notification to Alice if the email cannot be sent
- **SMTP handshake**
	- This occurs after the TCP connection between the send and receiver mail server
	- **Message sequence(S: server, C: client)**
		- S: 220 server_hostname 
		- C: HELO receiver_hostname 
		- S: Mail from Alice 
		- C: OK  
		- C: Rcpt to Bob 
		- S: OK
		- C: DATA
		- C: << Email data >>
		- C: .
		- S: 250 Message accepted for delivery 
		- C: QUIT
		- S: 221 closing connection
	- Here the << Email data >> has two parts separated by a blank line, header and the email. Header contains info(similar to HTTP header syntax) such as sender email, receiver email, subject.
- **Accessing email**
	- The receiver user agent uses protocols like POP and IMAP to retrieve the emails from the mail server
	- POP: 
		- Stateful protocol used to download the message from the server
		- Deletes the mail after it is retrieved from the mail server
		- POP3 has two modes that allows users to keep mail in the server even after retrieval
	- IMAP: 
		- Stateful protocol used to organize messages in the remote server
		- Can also retrieve the emails form the mail server
		- Messages are organised in folders in the remote server 
